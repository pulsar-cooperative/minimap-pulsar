{"mappings":"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","sources":["lib/minimap-plugin-generator-element.js"],"sourcesContent":["\"use strict\"\n\nimport { dasherize } from \"./deps/underscore-plus\"\nimport { getHomeDirectory, existsSync } from \"fs-plus\"\nimport path from \"path\"\nimport { BufferedProcess } from \"atom\"\nimport element from \"./decorators/element\"\n\nconst TAG_NAME = \"minimap-plugin-generator\"\n\n/** @access private */\nclass MinimapPluginGeneratorElement extends HTMLElement {\n  static initClass() {\n    this.registerCommands()\n    element(this, TAG_NAME)\n  }\n\n  static registerCommands() {\n    atom.commands.add(\"minimap-plugin-generator\", {\n      \"core:confirm\"() {\n        this.confirm()\n      },\n      \"core:cancel\"() {\n        this.detach()\n      },\n    })\n  }\n\n  createdCallback() {\n    this.previouslyFocusedElement = null\n    this.mode = null\n\n    this.modal = document.createElement(\"atom-panel\")\n\n    this.modal.classList.add(\"minimap-plugin-generator\")\n    this.modal.classList.add(\"modal\")\n    this.modal.classList.add(\"overlay\")\n    this.modal.classList.add(\"from-top\")\n\n    this.editor = atom.workspace.buildTextEditor({ mini: true })\n    this.editorElement = atom.views.getView(this.editor)\n\n    this.error = document.createElement(\"div\")\n    this.error.classList.add(\"error\")\n\n    this.message = document.createElement(\"div\")\n    this.message.classList.add(\"message\")\n\n    this.modal.appendChild(this.editorElement)\n    this.modal.appendChild(this.error)\n    this.modal.appendChild(this.message)\n\n    this.appendChild(this.modal)\n  }\n\n  connectedCallback() {\n    this.previouslyFocusedElement = document.activeElement\n    this.message.textContent = \"Enter plugin path\"\n    this.setPathText(\"my-minimap-plugin\")\n    this.editorElement.focus()\n  }\n\n  attach() {\n    atom.views.getView(atom.workspace).appendChild(this)\n  }\n\n  setPathText(placeholderName, rangeToSelect) {\n    if (!rangeToSelect) {\n      rangeToSelect = [0, placeholderName.length]\n    }\n\n    const packagesDirectory = getPackagesDirectory()\n\n    this.editor.setText(path.join(packagesDirectory, placeholderName))\n\n    const pathLength = this.editor.getText().length\n    const endOfDirectoryIndex = pathLength - placeholderName.length\n\n    this.editor.setSelectedBufferRange([\n      [0, endOfDirectoryIndex + rangeToSelect[0]],\n      [0, endOfDirectoryIndex + rangeToSelect[1]],\n    ])\n  }\n\n  detach() {\n    if (!this.parentNode) {\n      return\n    }\n\n    if (this.previouslyFocusedElement) {\n      this.previouslyFocusedElement.focus()\n    }\n\n    this.parentNode.removeChild(this)\n  }\n\n  confirm() {\n    if (this.validPackagePath()) {\n      this.removeChild(this.modal)\n      this.message.innerHTML = `\n        <span class='loading loading-spinner-tiny inline-block'></span>\n        Generate plugin at <span class=\"text-primary\">${this.getPackagePath()}</span>\n      `\n\n      this.createPackageFiles(() => {\n        const packagePath = this.getPackagePath()\n        atom.open({ pathsToOpen: [packagePath], devMode: atom.config.get(\"minimap.createPluginInDevMode\") })\n\n        this.message.innerHTML = '<span class=\"text-success\">Plugin successfully generated, opening it now...</span>'\n\n        setTimeout(() => {\n          this.detach()\n        }, 2000)\n      })\n    }\n  }\n\n  getPackagePath() {\n    const packagePath = this.editor.getText()\n    const packageName = dasherize(path.basename(packagePath))\n\n    return path.join(path.dirname(packagePath), packageName)\n  }\n\n  validPackagePath() {\n    if (existsSync(this.getPackagePath())) {\n      this.error.textContent = `Path already exists at '${this.getPackagePath()}'`\n      this.error.style.display = \"block\"\n      return false\n    } else {\n      return true\n    }\n  }\n\n  initPackage(packagePath, callback) {\n    const templatePath = path.resolve(__dirname, path.join(\"..\", \"templates\", `plugin-${this.template}`))\n    runCommand(atom.packages.getApmPath(), [\"init\", \"-p\", `${packagePath}`, \"--template\", templatePath], callback)\n  }\n\n  createPackageFiles(callback) {\n    const packagePath = this.getPackagePath()\n\n    if (isStoredInDotAtom(packagePath)) {\n      this.initPackage(packagePath, () => {\n        installPackage(packagePath, callback)\n      })\n    } else {\n      this.initPackage(packagePath, () => {\n        linkPackage(packagePath, () => {\n          installPackage(packagePath, callback)\n        })\n      })\n    }\n  }\n}\n\nMinimapPluginGeneratorElement.initClass()\n\nexport function createMinimapPluginGeneratorElement() {\n  const element = document.createElement(TAG_NAME)\n  element.createdCallback()\n  return element\n}\n\nfunction linkPackage(packagePath, callback) {\n  const args = [\"link\"]\n  if (atom.config.get(\"minimap.createPluginInDevMode\")) {\n    args.push(\"--dev\")\n  }\n  args.push(packagePath.toString())\n\n  runCommand(atom.packages.getApmPath(), args, callback)\n}\n\nfunction installPackage(packagePath, callback) {\n  const args = [\"install\"]\n\n  runCommand(atom.packages.getApmPath(), args, callback, { cwd: packagePath })\n}\n\nfunction getPackagesDirectory() {\n  return atom.config.get(\"core.projectHome\") || process.env.ATOM_REPOS_HOME || path.join(getHomeDirectory(), \"github\")\n}\n\nfunction isStoredInDotAtom(packagePath) {\n  const packagesPath = path.join(atom.getConfigDirPath(), \"packages\", path.sep)\n  if (packagePath.indexOf(packagesPath) === 0) {\n    return true\n  }\n\n  const devPackagesPath = path.join(atom.getConfigDirPath(), \"dev\", \"packages\", path.sep)\n\n  return packagePath.indexOf(devPackagesPath) === 0\n}\n\nfunction runCommand(command, args, exit, options = {}) {\n  return new BufferedProcess({ command, args, exit, options })\n}\n"],"names":["$58fd565a3165499b$export$f3256239933044e7","element","document","createElement","$58fd565a3165499b$var$TAG_NAME","createdCallback","$58fd565a3165499b$var$installPackage","packagePath","callback","$58fd565a3165499b$var$runCommand","atom","packages","getApmPath","cwd","command","args","exit","options","$7Y3am$atom","BufferedProcess","$58fd565a3165499b$var$MinimapPluginGeneratorElement","HTMLElement","initClass","registerCommands","$9jcTZ","default","this","commands","add","confirm","detach","previouslyFocusedElement","mode","modal","classList","editor","workspace","buildTextEditor","mini","editorElement","views","getView","error","message","appendChild","connectedCallback","activeElement","textContent","setPathText","focus","attach","placeholderName","rangeToSelect","length","packagesDirectory","config","get","process","env","ATOM_REPOS_HOME","$parcel$interopDefault","$7Y3am$path","join","$7Y3am$fsplus","getHomeDirectory","setText","endOfDirectoryIndex","getText","setSelectedBufferRange","parentNode","removeChild","validPackagePath","innerHTML","getPackagePath","createPackageFiles","open","pathsToOpen","devMode","setTimeout","packageName","$bNORb","dasherize","basename","dirname","existsSync","style","display","initPackage","templatePath","resolve","__dirname","template","packagesPath","getConfigDirPath","sep","indexOf","devPackagesPath","$58fd565a3165499b$var$isStoredInDotAtom","push","$58fd565a3165499b$var$linkPackage"],"version":3,"file":"minimap-plugin-generator-element.68264bbd.js.map"}